<!DOCTYPE html>
<html>
<head>
	<title>Testing Service Worker</title>
</head>
<body style='margin:0;overflow:hidden;'>
	<script src='../libs/three.js'></script>
	<script src='../libs/controls/DeviceOrientationControls.js'></script>
	<script>
		'use strict';
		
		var scene, renderer, camera, controls;
		
		setScene();

		function setScene(){
			renderer = new THREE.WebGLRenderer();
			renderer.setSize( innerWidth, innerHeight );
			document.body.appendChild( renderer.domElement );


			camera = new THREE.PerspectiveCamera( 70, innerWidth / innerHeight, 1, 100 );
			camera.position.z = 2;
			controls = new THREE.DeviceOrientationControls( camera );

			scene = new THREE.Scene();

			var sphere = new THREE.Mesh(
				new THREE.SphereBufferGeometry(15,30,30),
				new THREE.MeshBasicMaterial({
					map:new THREE.TextureLoader().load('sky.png'),
					color:0xffffff,
					side:THREE.BackSide
				}));

			scene.add( sphere );

			window.addEventListener( 'resize', function () {
				renderer.setSize( innerWidth, innerHeight );
				camera.aspect = innerWidth / innerHeight;
				camera.updateProjectionMatrix();
			}, false );

			setMotionInfo();

			animate();
		}

		function setMotionInfo () {
			var p = document.createElement( 'p' );
			p.style.cssText = ''+
				'position:absolute;'+
				'top:0;left:0;padding:10px;'+
				'color:#fff;font-size:20px;';
			document.body.appendChild( p );


			var eye = new THREE.Vector3(0,0,-1),
				up = new THREE.Vector3(0,1,0),
				right = new THREE.Vector3(1,0,0),
				mov = new THREE.Vector3();

			window.addEventListener( 'devicemotion', function ( e ) {
				p.innerHTML = '';
				for ( var k in e ) {
					if ( k === 'acceleration' ) {
						p.innerHTML += k + ' :<br>';
						for ( var l in e[ k ] ) p.innerHTML += '     ' + l + ' : ' + e[ k ][ l ] + ', <br>';
					}
				}
				eye.applyQuaternion( camera.quaternion );
				up.applyQuaternion( camera.quaternion );
				right.applyQuaternion( camera.quaternion );

				mov.addVectors( 
					right.multiplyScalar( e.acceleration.x ),
					up.multiplyScalar( e.acceleration.y )
					)
					.add( eye.multiplyScalar( e.acceleration.z ) );

				camera.position.add( mov );

				p.innerHTML += mov.x + '<br>' + mov.y + '<br>' + mov.z;
			}, false );
		}

		function animate () {
			requestAnimationFrame( animate );
			controls.update();
			renderer.render( scene, camera );
		}
	</script>
	<script>
		// if ( 'serviceWorker' in navigator ) {
		// 	navigator.serviceWorker.register( 'sw.js' ).then( function ( res ){
		// 		console.info('service worker installation complete, the app will be available offline after this session');
		// 	}).catch( function ( err ) {
		// 		console.info('the service worker failed to install, the app will not be available offline after this session');
		// 	});
		// 	var c = navigator.serviceWorker.controller
		// 	console.log( c );
		// 	if (c) c.addEventListener('message',function(e){console.log(e)});
		// }
	</script>
</body>
</html>