<!DOCTYPE html>
<html>
<head>
	<title>CASTRES</title>
	<link href='style.css' rel=stylesheet>
	<!-- hide adress bar and prevent scaling on ios -->
	<!-- enable fullscreen if added to home screen -->
	<meta name="apple-mobile-web-app-capable" content="yes">
</head>
<body>
	<!-- libs -->
	<script src='../libs/three.js'></script>
	<script src='../libs/controls/TrackballControls_modified.js'></script>
	<!--<script src='../../three/examples/js/controls/FlyControls.js'></script>-->
	<script src='http://cdnjs.cloudflare.com/ajax/libs/gsap/1.17.0/TweenMax.min.js'></script>
	<script src='https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js'></script>
	<script src='https://cdnjs.cloudflare.com/ajax/libs/detectizr/2.1.0/detectizr.min.js'></script>
	<!-- resources -->
	<script src='scripts/resources.js'></script>
	<script src='scripts/loadScreen.js'></script>
	<script src='scripts/trees.js'></script>
	<script src='scripts/cars.js'></script>
	<script src='scripts/scene.js'></script>
	<script src='scripts/UI.js'></script>
	<script>

		'use strict';

		initLoadScreen();

		var scene, renderer, canvasContainer;
		var camera, controls;

	    var steps=[
	            {
	                dateFrom:'2011',
	                dateTo:'JUN 2014',
	                title:"Vente du terrain",
	                description:"Déménagement de l'hôpital au Causse, vente du terrain puis désamiantage"
	            },
	            {
	                dateFrom:'JUN 2014',
	                dateTo:'JAN 2015',
	                title:'Déconstruction et terrassement',
	                description:'Déconstruction, terrassement et reliage de la voirie et des réseaux divers'
	            },
	            {
	                dateFrom:'JAN 2015',
	                dateTo:'JAN 2016',
	                title:'Gros oeuvre',
	                description:'Construction du parking, des résidences et commerces et aménagements du bâtiment Gambetta'
	            },
	        ];

		function initScene(data){		    
		    SCENE.set(data);
		    camera.lastPosition=new THREE.Vector3().copy(camera.position);

		    UI.set(data);

		    animate();

            if(Detectizr.device.type!=='desktop')UI.setLow(true);
            else for(var i=0;i<CARS.streetMesh.length;i++)scene.add(CARS.streetMesh[i]);

		    //test to output an image
		    //renderer.setPixelRatio(3);
		    //renderer.setSize(3*innerWidth,3*innerHeight);
		    //renderer.render(scene,camera);

		    //var img=renderer.domElement.toDataURL();
		    //var i=document.createElement('img');
		    //i.src=img;
		    //var a =document.createElement('a');
		    //a.href=img;
		    //a.download='rendered.png';
		    //a.innerHTML='click HERE !!!'
		    //a.style.cssText='position:absolute;top:10px;left:100px;'
		    //document.body.appendChild(a);
		}

		function animate(){
		    window.requestAnimationFrame(animate);

			controls.update();

			if(!camera.position.equals(camera.lastPosition)||camera.update){
			    //COMPASS
			    if(UI.compass.updateCompass){
			        UI.compass.compassCamera.position.copy(camera.position);
			        UI.compass.compassCamera.position.normalize().multiplyScalar(2);
			        UI.compass.compassCamera.up.copy(camera.up);
			        UI.compass.compassCamera.lookAt(UI.compass.compassScene.position);
			        UI.compass.compassRenderer.render(UI.compass.compassScene,UI.compass.compassCamera);
			    }
			    renderer.render(scene,camera);
				camera.lastPosition.copy(camera.position)
				camera.update=false;
			}
		        
		}
	</script>
</body>
</html>